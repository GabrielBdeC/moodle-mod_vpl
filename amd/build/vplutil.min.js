define(["jquery","jqueryui","core/log"],function(a,b,c){var d={doNothing:a.noop,returnFalse:function(){return!1},returnTrue:function(){return!0}},e=!1;return d.log=function(a,b){(e||b)&&c.debug(a)},d.setUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify(b),contentType:"application/json; charset=utf-8",dataType:"json"})},d.getUserPreferences=function(b){a.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({getPreferences:!0}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(b)},d.scrollBarWidth=function(){var b,c,d;return b=a("<div style=\"width:50px;height:50px;overflow:auto\"><div/></div>").appendTo("body"),c=b.children(),d=c.innerWidth()-c.height(99).innerWidth(),b.remove(),d},d.sanitizeHTML=function(b){return"undefined"==typeof b||""==b.replace(/^\s+$/g,"")?"":a("<div>"+b+"</div>").html()},d.sanitizeText=function(a){return"undefined"==typeof a||""==a.replace(/^\s+$/g,"")?"":a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},d.setProtocol=function(a){var b;if(0==a.securePort||0==a.port)b=0==a.port;else switch(a.wsProtocol){case"always_use_wss":b=!0;break;case"always_use_ws":b=!1;break;default:b="https:"==window.location.protocol;}var c=(b?"wss://":"ws://")+a.server;a.secure=b,a.portToUse=b?a.securePort:a.port,c+=":"+a.portToUse+"/",a.monitorURL=c+a.monitorPath,a.executionURL=c+a.executionPath},d.ArrayBuffer2String=function(a){var b,c,d=new Uint8Array(a),e=[],f=32e3;for(b=0,c=d.length;b<c;b+=f)e.push(String.fromCharCode.apply(String,d.subarray(b,Math.min(b+f,c))));return e.join("")},d.String2ArrayBuffer=function(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c},function(){var a=0;d.getUniqueId=function(){return a++}}(),function(){var a=/\.([^.]*)$/,b=/^(gif|jpg|jpeg|png|ico)$/i,c=/^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i,e=/^blockly[0123]?$/;d.fileExtension=function(b){var c=a.exec(b);return null===c?"":c[1]},d.isImage=function(a){return b.test(d.fileExtension(a))},d.isBinary=function(a){return d.isImage(a)||c.test(d.fileExtension(a))},d.isBlockly=function(a){return e.test(d.fileExtension(a))};var f=/[\cA-\cZ]|[:-@]|[{-~]|\\|\[|\]|[/^`Â´]|^-|^ | $|\.\./;d.validFileName=function(a){return!(1>a.length)&&!(128<a.length)&&!f.test(a)}}(),d.getCurrentTime=function(){return parseInt(new Date().valueOf()/1e3)},d.encodeBinary=function(a,b){return d.isBinary(a)?btoa(d.ArrayBuffer2String(b)):btoa(unescape(encodeURIComponent(b)))},d.decodeBinary=function(a,b){var c=atob(b);return d.isBinary(a)?d.String2ArrayBuffer(c):decodeURIComponent(escape(c))},d.validPath=function(a){if(256<a.length)return!1;for(var b=a.split("/"),c=0;c<b.length;c++)if(!d.validFileName(b[c]))return!1;return!0},d.getFileName=function(a){var b=a.split("/");return b[b.length-1]},d.dataFromURLData=function(a){return a.substr(a.indexOf(",")+1)},d.readZipFile=function(a,b,c,e){function f(a){if(a>=j||c.isClosed())return void e();var g,k=h.entries[a],l=k.fileName;if(l.match(/\/$/))f(a+1);else{c.processFile(l);var m="";if(0===k.compressionMethod?m=k.data:8===k.compressionMethod&&(m=JSInflate.inflate(k.data)),d.isBinary(l))b({name:l,contents:btoa(m),encoding:1}),f(a+1);else{g=d.String2ArrayBuffer(m);var n=new Blob([g],{type:"text/plain"}),o=new FileReader;o.onload=function(c){b({name:l,contents:c.target.result,encoding:0}),f(a+1)},o.onerror=function(b){d.log(b),a=j,f(a+1)},o.readAsText(n)}}}if(e||(e=d.doNothing),"undefined"==typeof JUnzip)return void d.loadScript(["../editor/zip/inflate.js","../editor/zip/unzip.js"],function(){d.readZipFile(a,b,c,e)});var g=d.ArrayBuffer2String(a),h=new JUnzip(g);if(!h.isZipFile())return d.log("Not a ZIP file"),void e();h.readEntries();var j=h.entries.length;f(0)},d.readSelectedFiles=function(a,b,c){function g(j){if(j>=a.length||h.isClosed())return c(),h.close(),void(""<i&&d.showErrorMessage(i));var k=a[j];h.processFile(k.name);var f=d.isBinary(k.name),l=new FileReader,m=d.fileExtension(k.name).toLowerCase();l.onload=function(a){if(!f)b({name:k.name,contents:a.target.result,encoding:0});else if("zip"==m)try{return void d.readZipFile(a.target.result,b,h,function(){g(j+1)})}catch(a){d.showErrorMessage(a+" : "+k.name)}else{var c=d.dataFromURLData(a.target.result);b({name:k.name,contents:c,encoding:1})}g(j+1)},l.onerror=function(a){i+="Error \""+a.target.error+"\" reading "+k.name+"\n",g(j+1)},f?"zip"==m?l.readAsArrayBuffer(k):l.readAsDataURL(k):l.readAsText(k)}var h=new d.progressBar("import","import"),i="";c||(c=d.doNothing),h.processFile=function(a){h.setLabel(a)},g(0)},function(){var a={gif:"image/gif",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",ico:"image/vnd.microsoft.icon",pdf:"application/pdf"};d.getMIME=function(b){var c=d.fileExtension(b);return c in a?a[c]:"application/octet-stream"},d.getTimeLeft=function(a){var b="",c=60,d=60*c,e=24*d;0>a&&(b+="-",a=-a);var f=a,g=parseInt(f/e);f-=g*e,0!==g&&(b+=g+"T");var h=parseInt(f/d);f-=h*d;var i=parseInt(f/c);f-=i*c;var j=parseInt(f);return b+=("00"+h).substr(-2)+":",b+=("00"+i).substr(-2),a<d&&(b+=":"+("00"+j).substr(-2)),b}}(),function(){var a={abap:"abap",abc:"abc",ada:"ada",ads:"ada",adb:"ada",as:"actionscript",as3:"actionscript",asm:"assembly_x86",bash:"sh",bat:"batchfile",c:"c_cpp",C:"c_cpp",cc:"c_cpp",cpp:"c_cpp","c++":"c_cpp",hxx:"c_cpp",h:"c_cpp",H:"c_cpp",cases:"cases",cbl:"cobol",cob:"cobol",coffee:"coffee",clj:"clojure",cs:"csharp",css:"css",d:"d",dart:"dart",e:"eiffel",erl:"erlang",hrl:"erlang",f:"fortran",f77:"fortran",f90:"fortran",for:"fortran",go:"golang",groovy:"groovy",gv:"dot",hs:"haskell",htm:"html",html:"html",hx:"haxe",java:"java",jl:"julia",js:"javascript",json:"json",jsp:"jsp",jsx:"jsx",kt:"kotlin",kts:"kotlin",m:"matlab",md:"markdown",less:"less",lisp:"lisp",lsp:"lisp",lua:"lua",pas:"pascal",p:"pascal",perl:"perl",prl:"perl",php:"php",pro:"prolog",pl:"prolog",py:"python",R:"r",r:"r",rb:"ruby",ruby:"ruby",s:"assembly_x86",sass:"sass",scala:"scala",scm:"scheme",scss:"scss",sh:"sh",swift:"swift",sql:"sql",svg:"svg",tex:"tex",tcl:"tcl",ts:"typescript",twig:"twig",vbs:"vbscript",v:"verilog",vh:"verilog",vhd:"vhdl",vhdl:"vhdl",xml:"xml",yaml:"yaml"};d.langType=function(b){return b in a?a[b]:"plain_text"}}(),function(){var a={},b=/\{\\*\$a\\*}/g;d.str=function(c,d){return a[c]?"undefined"==typeof d?a[c]:a[c].replace(b,d):"{"+c+"}"},d.setStr=function(b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);d.dialogbaseOptions={minWidth:200,autoOpen:!1,width:"auto",closeText:d.str("cancel"),modal:!0,dialogClass:"vpl_ide vpl_ide_dialog"}},d.setStr(window.VPLi18n)}(),function(){var a={},b={},c=100,e=0;d.delay=function(b,c,d,f){"undefined"!=typeof a[b]&&(clearTimeout(a[b]),e--),e++,a[b]=setTimeout(function(){e--,c(d,f),delete a[b]},20)},d.longDelay=function(b,d,f,g){"undefined"!=typeof a[b]&&(clearTimeout(a[b]),e--),e++,a[b]=setTimeout(function(){e--,d(f,g),delete a[b]},c)};var f=function(a,d,g,h){return"undefined"!=typeof b[a]&&clearTimeout(b[a]),setTimeout(function(){0<e?b[a]=f(a,d,g,h):(d(g,h),delete b[a])},c)};d.afterAll=function(a,c,d,e){b[a]=f(a,c,d,e)}}(),d.iconModified=function(){var a="<span title=\""+d.str("modified")+"\" class=\"vpl_ide_charicon\">";return a+="<i class=\"fa fa-star\"></i></span> ",a},d.iconDelete=function(){var a=" <span title=\""+d.str("delete")+"\" class=\"vpl_ide_charicon vpl_ide_delicon\">";return a+="<i class=\"fa fa-trash\"></i></span> ",a},d.iconClose=function(){var a=" <span title=\""+d.str("closebuttontitle");return a+="\" class=\"vpl_ide_charicon vpl_ide_closeicon\"><i class=\"fa fa-remove\"></i></span> ",a},d.iconRequired=function(){var a=" <span title=\""+d.str("required")+"\" class=\"vpl_ide_charicon\">";return a+="<i class=\"fa fa-shield\"></i></span> ",a},d.iconFolder=function(){return"<i class=\"fa fa-folder-open-o\"></i>"},function(){var a={filelist:"folder-open-o",filelistclose:"folder-o",new:"file-code-o",rename:"pencil",delete:"trash",multidelete:"trash|list",close:"remove",comments:"commenting",import:"upload",print:"print",edit:"edit",undo:"undo",redo:"repeat",select_all:"location-arrow",find:"search",find_replace:"exchange",next:"search-plus",resetfiles:"refresh",download:"download",fullscreen:"expand",regularscreen:"compress",save:"save",shortcuts:"flash",sort:"list-ol",run:"rocket",running:"rocket fa-spin",debug:"bug",evaluate:"check-square-o",console:"terminal",about:"question",info:"info-circle",alert:"warning",trash:"trash",retrieve:"download",spinner:"refresh fa-spin",keyboard:"keyboard-o",clipboard:"clipboard",timeleft:"clock-o",copy:"copy",paste:"paste",more:"plus-square",less:"minus-square",resize:"arrows-alt",graphic:"picture-o",send:"send",theme:"paint-brush",user:"user",fontsize:"text-height","close-rightpanel":"caret-square-o-right","open-rightpanel":"caret-square-o-left"};d.genIcon=function(b,c){if(!a[b])return"";var d="fa fa-";d+=c?c:"lg";for(var e=a[b].split("|"),f="",g=0;g<e.length;g++)f+="<i class='"+d+" fa-"+e[g]+"'></i>";return f}}(),d.setTitleBar=function(b,c,e,f,g){function h(a){var b="<a id='vpl_"+c+"_"+a+"' href='#' title='"+d.str(a)+"'>";return b+=d.genIcon(a,"fw")+"</a>",b}var j=a(b).parent().find("span.ui-dialog-title"),k=d.genIcon(e);k+=" <span class='"+c+"-title-buttons'></span>",k+="<span class='"+c+"-title-text'></span>",j.html(k);var l=j.find("span."+c+"-title-buttons"),m=j.find("span."+c+"-title-text");k="";for(var n=0;n<f.length;n++)k+=h(f[n]);l.html(k);for(var o,p=0;p<g.length;p++)o=j.find("#vpl_"+c+"_"+f[p]),o.button().click(g[p]),o.css("padding","1px 3px");return l.on("focus","*",function(){a(this).blur()}),m},d.setDialogTitleIcon=function(b,c){var e=a(b).parent().find("span.ui-dialog-title");e.html(d.genIcon(c)+" "+e.html())},d.progressBar=function(b,c,e){var f="<span class=\"vpl_ide_progressbarlabel\"></span>",g="<div class=\"vpl_ide_progressbaricon\">"+d.genIcon("spinner")+"</div>",h=" <div class=\"vpl_ide_progressbar\">"+g+"<span class=\"vpl_ide_progressbarlabel\"></span></div>",i="<div class=\"vpl_ide_dialog\" style=\"display:none;\">"+h+"</div>",j=a(i);a("body").append(j);var k=j.find(".vpl_ide_progressbar"),l=k.find(".vpl_ide_progressbarlabel");j.dialog({title:d.str(b),resizable:!1,autoOpen:!1,width:200,height:20,minHeight:20,modal:!0,dialogClass:"vpl_ide vpl_ide_dialog",close:function(a){j&&(e&&a.originalEvent&&e(),e=!1)}}),this.setLabel=function(a,b){j&&(l.text(a),b&&l.html(d.genIcon(b)+" "+l.html()))},this.close=function(){j&&(j.dialog("destroy"),a(j).remove(),j=!1)},this.isClosed=function(){return!1===j};var m=j.siblings().find(".ui-dialog-title");m.html(d.genIcon(b)+" "+m.html()),this.setLabel(d.str(c)),j.dialog("open"),j.dialog("option","height","auto")},d.showMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,c),f=a("<div class=\"vpl_ide_dialog\" style=\"display:none\"></div>"),g="",h=" <span class=\"dmessage\">"+b.replace(/\n/g,"<br>")+"</span>";f.html(h),"undefined"==typeof e.icon?g="info":(g=e.icon,delete e.icon),e.title||(e.title=d.str("warning")),a("body").append(f);var i={};"function"==typeof c.ok?(i[d.str("ok")]=function(){a(this).dialog("close"),c.ok()},i[d.str("cancel")]=function(){a(this).dialog("close")},delete e.ok):"function"==typeof c.yes?(i[d.str("yes")]=function(){a(this).dialog("close"),c.yes()},i[d.str("no")]=function(){a(this).dialog("close")},delete e.yes):i[d.str("close")]=function(){a(this).dialog("close")},e.next&&(i[d.str("next")]=function(){a(this).dialog("close"),c.next()}),e.close=function(){a(this).remove(),c.close&&c.close()},e.buttons=i,f.dialog(e);var j=f.siblings().find(".ui-dialog-title");return j.html(d.genIcon(g)+" "+j.html()),f.setMessage=function(b){a(f).find(".dmessage").html(b.replace(/\n/g,"<br>"))},f.dialog("open"),f},d.showErrorMessage=function(b,c){var e=a.extend({},d.dialogbaseOptions,{title:d.str("error"),icon:"alert"});return c&&(e=a.extend(e,c)),d.showMessage(b,e)},d.requestAction=function(b,c,f,g,h){var i=a.Deferred(),j=null,k=!1,l=!1;return h||(""===c&&(c="connecting"),l=new d.progressBar(b,c,function(){4!=j.readyState&&k&&k.abort&&k.abort()})),j=a.ajax({beforeSend:function(a){return k=a,!0},async:!0,type:"POST",url:g+b,data:JSON.stringify(f),contentType:"application/json; charset=utf-8",dataType:"json"}).always(function(){h||l.close()}).done(function(a){a.success?i.resolve(a.response):i.reject(a.error)}).fail(function(a,b,c){var f=d.str("connection_fail")+": "+b;e&&null!=c.message&&(f+=": "+c.message),d.log(f),i.reject(f)}),i},d.supportWebSocket=function(){return!!("WebSocket"in window)},d.isAndroid=function(){return-1<window.navigator.userAgent.indexOf("Android")},d.isFirefox=function(){return-1<window.navigator.userAgent.indexOf("Firefox")},d.isMac=function(){return-1<window.navigator.userAgent.indexOf("Mac")},d.clickServer=function(b){var c=550,e=450,f=screen.width/2-275,g=screen.height/2-e/2;try{var h="toolbar=no, location=no, directories=no, status=no, menubar=no";h+=", resizable=yes, scrollbars=yes, copyhistory=no, width=550",h+=", height="+e+", top="+g+", left="+f;var i=window.open(a(this).attr("href"),"_blank",h);if(!i)return!0}catch(a){return d.log(a),!0}return b.preventDefault(),a(this).parent().hide(),!1},d.acceptCertificates=function(b,c){if(0<b.length){var e=d.str("acceptcertificatesnote");e+="<ol>";var f;for(f in b)if(b.hasOwnProperty(f)){var g=1+f;e+="<li><a href=\""+b[f]+"\" target=\"_blank\">Server ",e+=g+"</a></li>"}e+="</ol>";var h=d.showMessage(e,{ok:function(){var a=c();a&&a()},icon:"unlocked",title:d.str("acceptcertificates")});a(h).find("a").on("click keypress",d.clickServer)}else d.log("servers.length == 0"),d.showErrorMessage(d.str("connection_fail"))},d.monitorRunning=d.returnFalse,function(){var a=-1;d.setProcessId=function(b){a=b},d.getProcessId=function(){return a}}(),d.webSocketMonitor=function(b,c,e,f){d.setProtocol(b),d.setProcessId(b.processid);var g=null,h=null,i=a.Deferred(),j=function(a){i.reject(a)},k=!1,l={message:function(a){var b=/^([^:]*):?([^]*)/.exec(a),c=b[1],g=b[2];"running"==c&&(c=e);var i=d.str(c);""<g&&(i+=": "+g),null===h||h.isClosed()?f.getConsole&&f.getConsole().isOpen()?f.getConsole().setMessage(i):d.log("Error: no dialogo. Message not shown: "+i):h.setLabel(i)},compilation:function(a){f.setResult&&f.setResult({compilation:a},!1)},retrieve:function(){var a={processid:d.getProcessId()};h.close(),k=!0,d.requestAction("retrieve","",a,f.ajaxurl).done(function(a){i.resolve(),f.setResult&&f.setResult(a,!0)}).fail(j)},run:function(a){h.close(),f.run(a,b,g)},close:function(){d.log("ws close message from jail"),g.close();var a={processid:d.getProcessId()};d.requestAction("cancel","",a,f.ajaxurl,!0)}};try{if(d.supportWebSocket())g=new WebSocket(b.monitorURL);else return d.log("ws not available"),i.reject(d.str("browserupdate")),i}catch(a){return d.log("ws new say "+a),i.reject(a.message),i}return h=new d.progressBar(c,"connecting",function(){i.reject("Stopped by user"),g.close()}),g.notOpen=!0,g.onopen=function(){g.notOpen=!1,h.setLabel(d.str("connected")),f.open&&f.open()},g.onerror=function(a){d.log("ws error "+a),h.close(),b.secure&&g.notOpen?d.requestAction("getjails","retrieve",{},f.ajaxurl).done(function(a){d.acceptCertificates(a.servers,function(){return f.getLastAction()})}).fail(j):i.reject(d.str("connection_fail")),f.close&&d.delay("externalActions.close",f.close)},g.onclose=function(){f.getConsole&&f.getConsole().disconnect(),g.notOpen||(h.close(),!k&&"rejected"!=i.state()&&i.resolve()),f.close&&f.close()},g.onmessage=function(a){var b=/^([^:]+):([^]*)/.exec(a.data);if(null!==b){var c=b[1],e=b[2];l[c]&&l[c](e)}else h.setLabel(d.str("error")+": "+a.data)},d.monitorRunning=function(){return null!==g&&g.readyState!=WebSocket.CLOSED},i},d.directRun=function(b,e,f){var g=a.Deferred();return a.ajax({async:!0,type:"POST",url:b+"directrun",data:JSON.stringify({command:e,files:f}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(a){if(!a.success)g.reject(a.error);else{var b=a.response;d.setProtocol(b);var e=new WebSocket(b.executionURL);c.debug("Conecting with:"+b.executionURL),g.resolve({processid:b.processid,homepath:b.homepath,connection:e})}}).fail(function(a,b,d){var e="Connection fail: "+b;null!=d.message&&(e+=": "+d.message),c.debug(e),g.reject(e)}),g},d.directRunTest=function(a,b,e){var f=[{name:"a.c",contents:"int main(){return 0;}",encoding:0},{name:"b.c",contents:"int f(){return 1;}",encoding:0}];d.directRun(a,b,f).done(function(a){var b=0;a.connection.onopen=function(){c.debug("Ws open "+a.homepath+" processid "+a.processid),null!=e&&a.connection.send(e),setTimeout(function(){a.connection.close()},600000)},a.connection.onmessage=function(d){c.debug("WS Message ("+ ++b+"): "+d.data),10<=b&&a.connection.close()},a.connection.onerror=function(a){c.debug("WS error: "+a)},a.connection.onclose=function(a){c.debug("WS close: "+a.code+" "+a.reason)}}).fail(function(d){c.debug("Direct run fail. URL: "+a+" command: "+b+" message: "+d)})},d.processResult=function(a,b,c,e,f){function g(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/,"\\$&")}function h(a){return"undefined"==typeof c[a].getTagId?"href=\"#\" ":"href=\"#"+c[a].getTagId()+"\" "}function j(a,e){for(var f=!1,g=0;g<A.length;g++)for(var j,k,l=A[g];null!==(j=l.exec(a));){k=c[g].getAnnotations(),C=g,f=!0;var m;m=-1<a.search(s)?"error":-1<a.search(t)?"warning":-1<a.search(u)?"info":"error",B={row:j[3]-1,column:j[5],type:m,text:e},k.push(B);var n=b[g],o=h(g),p=d.sanitizeText(n),q="data-file=\""+n+"\" data-line=\""+j[3]+"\"";a=a.replace(l,"$1<a "+o+" class=\"vpl_fl\" "+q+">"+p+"$2$3$4$5$6</a>"),c[g].setAnnotations(k)}return!f&&B&&(""===e?B=!1:(B.text+="\n"+e,c[C].setAnnotations(c[C].getAnnotations()))),a}function k(a){B=!1,a=a.substr(1);var b=p.exec(a);null!==b&&(a=a.substr(0,a.length-b[0].length));var c="";return f&&(c+="<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>"),c+="<b class=\"ui-widget-header ui-corner-all\">"+d.sanitizeText(a)+"</b><br>",c=j(c,a),c}function l(){B=!1;var a=x;return x="",a}function m(a){var b=d.sanitizeText(a);x+=j(b,a)+"<br>"}function n(a){var b=d.sanitizeText(a);y+=j(b,a)+"\n"}function o(){B=!1;var a=y;return y="","<pre><i>"+a+"</i></pre>"}if("undefined"==typeof a||""==a.replace(/^\s+$/gm,""))return"";var p=/\([-]?[\d]+[.]?[\d]*\)\s*$/,q=/^-.*/,r=/^\s*>/,s=new RegExp("\\[err\\]|error|"+g(d.str("error")),"i"),t=new RegExp("\\[warn\\]|warning|note|"+g(d.str("warning")),"i"),u=/\[info\]|information/i,v="",w="",x="",y="",z=a.split(/\r\n|\n|\r/),A=[],B=!1,C=!1,D=!1;(function(){for(var a=0;a<b.length;a++){var c=g(b[a]),d="(^| |/)"+c+"( on line | line |:|\\()(\\d+)(:|,)?(\\d+)?(\\))?";A[a]=new RegExp(d,"m")}})();for(var E,F=0;F<z.length;F++){if(E=z[F],e){w+=j(d.sanitizeText(E),E)+"\n";continue}var G=r.exec(E),H=r.test(E);null!==G!=H&&d.log("error"),q.test(E)?("comment"===v?w+=l():"case"===v?w+=o():void 0,D&&(w+="</div>"),w+=k(E),w+=f?"<div style=\"display:none\">":"<div>",D=!0,v=""):H?("comment"==v&&(w+=l()),n(E.substr(G[0].length)),v="case"):("case"==v&&(w+=o()),m(E),v="comment")}return"comment"===v?w+=l():"case"===v?w+=o():void 0,D&&(w+="</div>"),w},function(){var a=[];d.loadScript=function(b,c){if(0==b.length)return void c();var e=b[0];if("undefined"==typeof a[e]){b.shift(),a[e]=1;var f=document.createElement("script");f.type="text/javascript",f.src=d.options.scriptPath+e,f.onload=function(){a[e]=2,d.loadScript(b,c)},document.head.appendChild(f)}else 2==a[e]?(b.shift(),d.loadScript(b,c)):(d.log("Error loading js "+e+" "+a[e]),setTimeout(function(){d.loadScript(b,c)},50))},d.isScriptLoading=function(b){return"undefined"!=typeof a[b]&&1==a[b]},d.isScriptLoaded=function(b){return"undefined"!=typeof a[b]&&2==a[b]}}(),d.adjustBlockly=function(a,b,c){for(var d,e=a.getAllBlocks(),f=2e4,g=-2e4,h=2e4,k=-2e4,l=0;l<e.length;l++)d=e[l].getRelativeToSurfaceXY(),f=Math.min(f,d.y),g=Math.max(g,d.y),h=Math.min(h,d.x),k=Math.max(k,d.x);e=a.getTopBlocks();for(var m=0;m<e.length;m++)e[m].moveBy(b-h,c-f);return g-f+100+c},function(){function b(a,b){var c=this;this.files=a,this.results=b,setTimeout(function(){c.highlight()},10)}var c=[],e=[],f=[];b.prototype.highlightBlockly=function(b){d.loadScript(["../editor/blockly/blockly_compressed.js","../editor/blockly/msg/js/en.js","../editor/blockly/blocks_compressed.js"],function(){var e=a("#"+b),f=e.html();a("#"+b+"load").remove(),e.html(""),e.show(),f=a("<div />").html(f).text().replace(/\n/g,"");var g=Blockly.Xml.textToDom(f);e.html("").height(300).width(e.parent().width());var i={toolbox:"",readOnly:!0,media:"../editor/blockly/media/"},j=Blockly.inject(b,i);Blockly.Xml.domToWorkspace(g,j);var k=d.adjustBlockly(j,10,10);e.height(k),e.width("100%"),Blockly.svgResize(j),Blockly.resizeSvgContents(j);var l=e.html();j.dispose(),e.html(l)})},b.prototype.highlight=function(){var b=this,c=!1,e=this.files;for(let a,b=0;b<e.length;b++)if(a=e[b],d.isBinary(a.fileName)||d.isBlockly(a.fileName))continue;else{c=!0;break}if(c&&"undefined"==typeof ace)return void d.loadScript(["../editor/ace9/ace.js"],function(){b.highlight()});var g=this.results,h=[],j=[];for(let c=0;c<e.length;c++){let g=e[c],i="code"+g.tagId;if(d.isBlockly(g.fileName)){b.highlightBlockly(i);continue}var k=d.fileExtension(g.fileName),l=d.langType(k);a("#"+i).show(),a("#"+i+"load").remove();var m=ace.edit(i);m.setTheme("ace/theme/"+g.theme),m.getSession().setMode("ace/mode/"+l),m.renderer.setShowGutter(g.showln),m.setReadOnly(!0),m.setHighlightActiveLine(!1),m.setAutoScrollEditorIntoView(!0),m.setOption("maxLines",g.nl),m.getAnnotations=function(){return this.getSession().getAnnotations()},m.setAnnotations=function(b){return this.getSession().setAnnotations(b)},m.getTagId=function(){return this.vplTagId},m.vplTagId=g.tagId,h.push(m),j.push(g.fileName),f[g.tagId]=m}for(var i=0;i<g.length;i++){var n=document.getElementById(g[i].tagId),o=n.textContent||n.innerText;n.innerHTML=d.processResult(o,j,h,g[i].noFormat,g[i].folding)}},d.addResults=function(a,b,c){e.push({tagId:a,noFormat:b,folding:c})},d.syntaxHighlightFile=function(a,b,d,e,f){c.push({tagId:a,fileName:b,theme:d,showln:e,nl:f})},d.syntaxHighlight=function(){new b(c,e),c=[],e=[]},d.flEventHandler=function(a){var b=a.target.getAttribute("href").substring(1),c=a.target.getAttribute("data-line"),d=f[b];d.gotoLine(c,0),d.scrollToLine(c,!0)},d.setflEventHandler=function(){for(var a=document.getElementsByClassName("vpl_fl"),b=0;b<a.length;b++)a[b].onclick=d.flEventHandler},d.showHideDiv=function(b){var a=b,c=b;for(c.nextSibling||(c=c.parentNode),c=c.nextSibling;"DIV"!=c.nodeName&&"PRE"!=c.nodeName;)if(c=c.nextSibling,!c)return;a&&("[+]"==a.innerHTML?(c.style.display=c.savedDisplay?c.savedDisplay:"",a.innerHTML="[-]"):(c.savedDisplay=c.style.display,c.style.display="none",a.innerHTML="[+]"))}}(),d.options={scriptPath:""},"undefined"!=typeof window.VPLDebugMode&&(e=window.VPLDebugMode),d.init=function(b){d.options={scriptPath:""},a.extend(d.options,b),"undefined"!=typeof window.VPLDebugMode&&(e=window.VPLDebugMode),d.log(d.options)},window.VPLUtil=d,d});