{"version":3,"file":"vplideblocklyfile.min.js","names":["define","$","VPLUtil","self","vplIdeInstance","getVPLIDE","firstContent","workspaceInstance","adaptBlockly","Blockly","PHP","workspaceToCodeOld","workspaceToCode","workspace","Python","oldAdjustSize","adjustSize","call","editTag","getTId","length","tabs","parent","newHeight","height","position","top","bdiv","width","svgResize","undo","isOpen","redo","interpreter","animateRun","RUNSTATE","STEPSTATE","STOPSTATE","executionState","goNext","initRun","animate","ter","getTerminal","isConnected","closeLocal","JavaScript","STATEMENT_PREFIX","addReservedWords","code","Interpreter","scope","setProperty","createNativeFunction","text","toString","createPrimitive","writeLocal","createAsyncFunction","callback","setDataCallback","t","id","getBreakpoint","updateRunButtons","setMessage","str","highlightBlock","connectLocal","stop","doNothing","reservedWords","Infinity","Array","Boolean","Date","Error","EvalError","Function","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","alert","arguments","constructor","eval","isFinite","isNaN","parseFloat","parseInt","prompt","this","window","breakpoint","lastSelection","setBreakpoint","removeBreakpoint","setLastSelection","selection","isSelectingBreakpoint","getVarValue","val","HTML","type","sanitizeText","class","ar","properties","i","getVariables","proname","pro","value","getParameters","args","showStack","level","sn","stack","stateStack","lastFunc","node","callee","name","arguments_","setResult","variables","runLoop","step","setTimeout","start","startAnimate","pause","resume","hasUndo","hasRedo","oldSetFileName","setFileName","generatorMap","py","dart","js","lua","php","generator","newName","oldFileName","getFileName","oldExt","fileExtension","log","ext2","exec","fn2","generatedFilename","updateGeneratedCode","afterAll","close","open","blocklyNotLoaded","fileManager","getFileManager","fid","fileNameExists","addFile","contents","fileGenerated","getFile","getContent","setContent","change","gotoLine","setReadOnly","changeCode","event","element","newValue","longDelay","clearUndo","recordUndo","triesUpdateRunButtons","removeClass","addClass","setToolbox","ext","toolboxname","ajax","url","dataType","success","data","blocklyIn18","addUpdateButtons","func","callBacks","blocklyStartButton","blocklyStartAnimateButton","blocklyStopButton","blocklyPauseButton","blocklyResumeButton","blocklyStepButton","blocklySelectBreakpointButton","blocklyRemoveBreakpointButton","wp","key","updateToolbox","registerButtonCallback","showFileName","loadScript","setOpen","fileName","horizontalMenu","test","tid","getId","html","options","toolbox","media","horizontalLayout","zoom","controls","wheel","startScale","maxScale","minScale","scaleSpeed","inject","addChangeListener","adjustBlockly","scrollX","scrollY","resizeSvgContents","getContentOld","xml","Xml","workspaceToDom","xmlText","domToPrettyText","setContentOld","c","clear","textToDom","domToWorkspace","dispose","blocklyToolbox","blockly0Toolbox","blockly1Toolbox","blockly2Toolbox","blockly3Toolbox","blocklyStrs","l","reg","rep","replace"],"sources":["../src/vplideblocklyfile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Blockly file management\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals Interpreter */\n/* globals Blockly */\n\ndefine(\n    [\n        'jquery',\n        'mod_vpl/vplutil',\n    ],\n    function($, VPLUtil) {\n        return function() {\n            var self = this;\n            var vplIdeInstance = this.getVPLIDE();\n            this.firstContent = true;\n            this.workspaceInstance = false;\n            var adaptBlockly = function() {\n                if (typeof Blockly.PHP.workspaceToCodeOld == 'undefined') {\n                    Blockly.PHP.workspaceToCodeOld = Blockly.PHP.workspaceToCode;\n                    Blockly.PHP.workspaceToCode = function(workspace) {\n                        return \"<?php\\n\" + Blockly.PHP.workspaceToCodeOld(workspace);\n                    };\n                }\n                if (typeof Blockly.Python.workspaceToCodeOld == 'undefined') {\n                    Blockly.Python.workspaceToCodeOld = Blockly.Python.workspaceToCode;\n                    Blockly.Python.workspaceToCode = function(workspace) {\n                        return \"# -*- coding: utf-8 -*-\\n\" + Blockly.Python.workspaceToCodeOld(workspace);\n                    };\n                }\n            };\n            var oldAdjustSize = this.adjustSize;\n            this.adjustSize = function() {\n                if (oldAdjustSize.call(this)) {\n                    var editTag = $(this.getTId());\n                    if (editTag.length === 0) {\n                        return false;\n                    }\n                    var tabs = editTag.parent();\n                    var newHeight = tabs.height();\n                    newHeight -= editTag.position().top;\n                    editTag.height(newHeight);\n                    $('#' + this.bdiv).height(newHeight);\n                    $('#' + this.bdiv).width(editTag.width());\n                    Blockly.svgResize(this.workspaceInstance);\n                    return false;\n                }\n                return false;\n            };\n            this.undo = function() {\n                if (this.isOpen()) {\n                    this.workspaceInstance.undo(false);\n                }\n            };\n            this.redo = function() {\n                if (this.isOpen()) {\n                    this.workspaceInstance.undo(true);\n                }\n            };\n            this.interpreter = false;\n            this.animateRun = false;\n            this.RUNSTATE = 1;\n            this.STEPSTATE = 2;\n            this.STOPSTATE = 3;\n            this.executionState = this.STOPSTATE;\n            this.goNext = false;\n            this.initRun = function(animate) {\n                var ter = vplIdeInstance.getTerminal();\n                if (ter.isConnected()) {\n                    ter.closeLocal();\n                }\n                this.animateRun = animate;\n                Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\\n';\n                Blockly.JavaScript.addReservedWords('highlightBlock');\n                var code = Blockly.JavaScript.workspaceToCode(self.workspaceInstance);\n                var initApi = function(interpreter, scope) {\n                    // Add an API function for the alert() block.\n                    var wrapperAlert = function(text) {\n                        text = typeof text != 'string' ? text.toString() + '\\r\\n' : text + '\\r\\n';\n                        return interpreter.createPrimitive(ter.writeLocal(text));\n                    };\n                    interpreter.setProperty(scope, 'alert',\n                            interpreter.createNativeFunction(wrapperAlert));\n\n                    // Add an API function for the prompt() block.\n                    var wrapperPrompt = function(text, callback) {\n                        text = typeof text != 'string' ? text.toString() : '' + text;\n                        ter.writeLocal(text);\n                        ter.setDataCallback(function(t) {\n                                               ter.writeLocal('\\n');\n                                               callback(t);\n                                            });\n                    };\n                    interpreter.setProperty(scope, 'prompt',\n                        interpreter.createAsyncFunction(wrapperPrompt));\n\n                    var wrapperHighlightBlock = function(id) {\n                        if (id == self.getBreakpoint()) {\n                            self.executionState = self.STEPSTATE;\n                            self.updateRunButtons();\n                            vplIdeInstance.getTerminal().setMessage(VPLUtil.str('breakpoint'));\n                        }\n                        if (self.animateRun || self.executionState == self.STEPSTATE) {\n                            self.workspaceInstance.highlightBlock(id);\n                        }\n                        self.goNext = false;\n                    };\n                    interpreter.setProperty(scope, 'highlightBlock',\n                            interpreter.createNativeFunction(wrapperHighlightBlock));\n                };\n                self.interpreter = new Interpreter(code, initApi);\n                ter.connectLocal(self.stop, VPLUtil.doNothing);\n            };\n            this.reservedWords = {\n                'Infinity': true, 'Array': true, 'Boolean': true,\n                'Date': true, 'Error': true, 'EvalError': true,\n                'Function': true, 'JSON': true, 'Math': true,\n                'NaN': true, 'Number': true, 'Object': true, 'RangeError': true,\n                'ReferenceError': true, 'RegExp': true, 'String': true,\n                'SyntaxError': true, 'TypeError': true, 'URIError': true,\n                'alert': true, 'arguments': true, 'constructor': true, 'eval': true,\n                'highlightBlock': true, 'isFinite': true,\n                'isNaN': true, 'parseFloat': true, 'parseInt': true, 'prompt': true,\n                'self': true, 'this': true, 'window': true,\n            };\n            (function() {\n                var breakpoint = null;\n                var lastSelection = null;\n                self.getBreakpoint = function() {\n                    return breakpoint;\n                };\n                self.setBreakpoint = function() {\n                    breakpoint = lastSelection;\n                };\n                self.removeBreakpoint = function() {\n                    breakpoint = null;\n                };\n                self.setLastSelection = function(selection) {\n                    lastSelection = selection;\n                };\n                self.isSelectingBreakpoint = function() {\n                    return breakpoint === null && lastSelection !== null;\n                };\n            })();\n            this.getVarValue = function(val) {\n                var HTML = '';\n                if (val === null) {\n                    HTML = \"<b>null</b>\";\n                } else if (val != undefined) {\n                    var type = typeof val;\n                    if (type == 'string') {\n                        HTML = '\"' + VPLUtil.sanitizeText(val) + '\"';\n                    } else if (type == 'boolean') {\n                        HTML = \"<b>\" + val + \"</b>\";\n                    } else if (type == 'object' && val.class === \"Array\") {\n                        HTML = '[';\n                        var ar = val.properties;\n                        for (var i = 0; i < ar.length; i++) {\n                            HTML += self.getVarValue(ar[i]);\n                            if (i != ar.length - 1) {\n                                HTML += ', ';\n                            }\n                        }\n                        HTML += ']';\n                    } else if (type == 'object') {\n                        HTML = \"<b>\" + val.toString() + \"</b>\";\n                    } else {\n                        HTML += '' + val;\n                    }\n                }\n                return HTML;\n            };\n            this.getVariables = function(properties) {\n                var HTML = '';\n                for (var proname in properties) {\n                    if (this.reservedWords[proname] === true) {\n                        continue;\n                    }\n                    var pro = properties[proname];\n                    if (pro != undefined && !(pro.class === \"Function\")) {\n                        var value = VPLUtil.sanitizeText(self.getVarValue(pro));\n                        HTML += '<b>' + proname + \"</b>:&nbsp;\" + value + \"<br>\\n\";\n                    }\n                }\n                return HTML;\n            };\n            this.getParameters = function(args) {\n                var HTML = '(';\n                for (var i = 0; i < args.length; i++) {\n                    HTML += '' + args[i];\n                    if (i < args.length - 1) {\n                        HTML += ', ';\n                    }\n                }\n                return HTML + ')';\n            };\n            this.showStack = function(interpreter) {\n                var sn = 0;\n                var HTML = '<table class=\"generaltable\">';\n                var stack = interpreter.stateStack;\n                var lastFunc = '<tr><td>0</td><td><b>Globals</b></td>';\n                for (var i = 0; i < stack.length; i++) {\n                    var level = stack[i];\n                    if (lastFunc > '' && (level.node.type == 'CallExpression' || i == stack.length - 1)) {\n                        HTML += lastFunc + '<td>' + self.getVariables(level.scope.properties);\n                        HTML += '</td></tr>';\n                    }\n                    if (level.node.type == 'CallExpression') {\n                        if (self.reservedWords[level.node.callee.name] !== true\n                        && level.node.callee.name != undefined) {\n                            sn++;\n                            lastFunc = '<tr><td>' + sn + '</td>';\n                            lastFunc += '<td>' + level.node.callee.name + self.getParameters(level.arguments_) + '</td>';\n                        } else {\n                            lastFunc = '';\n                        }\n                    }\n                }\n                HTML += '</table>';\n                vplIdeInstance.setResult({variables: HTML});\n            };\n            this.runLoop = function() {\n                if (!self.interpreter) {\n                    return;\n                }\n                self.goNext = true;\n                for (var i = 0; i < 30000 && self.goNext; i++) {\n                    if (self.executionState == self.STOPSTATE) {\n                        break;\n                    }\n                    if (!self.interpreter || !self.interpreter.step()) {\n                        self.executionState = self.STOPSTATE;\n                        self.updateRunButtons();\n                        break;\n                    }\n                }\n                if (self.executionState == self.STOPSTATE) {\n                    self.workspaceInstance.highlightBlock(-1);\n                    vplIdeInstance.getTerminal().closeLocal();\n                    vplIdeInstance.setResult({variables: ''});\n                    return;\n                }\n                if (self.executionState == self.RUNSTATE) {\n                    if (self.animateRun) {\n                        setTimeout(self.runLoop, 1000);\n                        self.showStack(self.interpreter);\n                    } else {\n                        setTimeout(self.runLoop, 0);\n                    }\n                } else {\n                    self.showStack(self.interpreter);\n                }\n            };\n            this.start = function() {\n                if (self.executionState != self.STOPSTATE) {\n                    return;\n                }\n                self.initRun(false);\n                self.executionState = self.RUNSTATE;\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('start'));\n                self.runLoop();\n            };\n            this.startAnimate = function() {\n                if (self.executionState != self.STOPSTATE) {\n                    return;\n                }\n                self.initRun(true);\n                self.executionState = self.RUNSTATE;\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('startanimate'));\n                self.runLoop();\n            };\n            this.stop = function() {\n                self.executionState = self.STOPSTATE;\n                self.workspaceInstance.highlightBlock(-1);\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('stop'));\n                vplIdeInstance.getTerminal().closeLocal();\n                self.interpreter = false;\n                vplIdeInstance.setResult({variables: ''});\n            };\n            this.pause = function() {\n                if (self.executionState != self.RUNSTATE) {\n                    return;\n                }\n                self.executionState = self.STEPSTATE;\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('pause'));\n                self.updateRunButtons();\n            };\n            this.resume = function() {\n                if (self.executionState != self.STEPSTATE) {\n                    return;\n                }\n                self.executionState = self.RUNSTATE;\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('resume'));\n                self.updateRunButtons();\n                self.runLoop();\n            };\n            this.step = function() {\n                if (self.executionState == self.STOPSTATE) {\n                    self.initRun(true);\n                }\n                self.executionState = self.STEPSTATE;\n                self.updateRunButtons();\n                vplIdeInstance.getTerminal().setMessage(VPLUtil.str('step'));\n                self.runLoop();\n            };\n            this.hasUndo = function() {\n                return true;\n            };\n            this.hasRedo = function() {\n                return true;\n            };\n            this.oldSetFileName = this.setFileName;\n            this.generatorMap = {\n                py: 'Python',\n                dart: 'Dart',\n                js: 'JavaScript',\n                lua: 'Lua',\n                php: 'PHP'\n            };\n            this.generator = '';\n            this.setFileName = function(newName) {\n                var oldFileName = this.getFileName();\n                var oldExt = VPLUtil.fileExtension(oldFileName);\n                if (!self.oldSetFileName(newName)) {\n                    VPLUtil.log(\"Blockly setFileName: name no acepted \" + newName);\n                    return false;\n                }\n                VPLUtil.log('Blockly set filename ' + newName);\n                var regExt2 = /\\.([^.]+)\\.blockly[123]?$/;\n                var regFn2 = /(.+)\\.blockly[123]?$/;\n                var ext2 = regExt2.exec(newName);\n                var fn2 = regFn2.exec(newName);\n                if (ext2 !== null && fn2 !== null && typeof this.generatorMap[ext2[1]] == 'string') {\n                    this.generator = this.generatorMap[ext2[1]];\n                    this.generatedFilename = fn2[1];\n                    VPLUtil.log('Blockly generator ' + this.generator + ' for filename ' + this.generatedFilename);\n                    this.updateGeneratedCode();\n                } else {\n                    this.generator = '';\n                }\n                if (oldExt != VPLUtil.fileExtension(newName)) {\n                    VPLUtil.log('Blockly extension changed');\n                    VPLUtil.afterAll('reopenBlockly', function() {\n                            VPLUtil.log('reopenBlockly');\n                            self.close();\n                            self.open();\n                        }\n                    );\n                }\n                return true;\n            };\n            this.updateGeneratedCode = function() {\n                if (self.blocklyNotLoaded) {\n                    return;\n                }\n                var fileManager = self.getFileManager();\n                if (self.generator != '') {\n                    VPLUtil.log('Blockly generate ' + self.generator);\n                    var fid = fileManager.fileNameExists(self.generatedFilename);\n                    // Try to create generated code file.\n                    if (fid == -1) {\n                        VPLUtil.log(\"try to create \" + self.generatedFilename + \" files\");\n                        fileManager.addFile({\n                            name: self.generatedFilename,\n                            contents: ''},\n                            false, VPLUtil.doNothing, VPLUtil.doNothing);\n                        fid = fileManager.fileNameExists(self.generatedFilename);\n                    }\n                    if (fid != -1) {\n                        var code = Blockly[self.generator].workspaceToCode(self.workspaceInstance);\n                        var fileGenerated = fileManager.getFile(fid);\n                        if (fileGenerated.getContent() != code) {\n                            fileGenerated.setContent(code);\n                            fileGenerated.change();\n                            fileGenerated.gotoLine(1);\n                            fileGenerated.setReadOnly(true);\n                        }\n                    }\n                }\n            };\n            this.changeCode = function(event) {\n                VPLUtil.log(event);\n                if (event.type == 'ui' && event.element == 'selected') {\n                    self.setLastSelection(event.newValue);\n                    return;\n                }\n                if (event.type == 'ui'\n                        && event.element == 'category'\n                        && event.newValue == VPLUtil.str('run')) {\n                        VPLUtil.longDelay('updateRunButtons', self.updateRunButtons);\n                    return;\n                }\n                if (self.firstContent) {\n                    if (event.type == 'finished_loading') {\n                        self.firstContent = false;\n                        self.workspaceInstance.clearUndo();\n                    } else {\n                        return;\n                    }\n                }\n                if (!event.recordUndo) {\n                    return;\n                }\n\n                VPLUtil.log('Call change due changeCode');\n                self.change();\n                if (self.generator != '') {\n                    VPLUtil.afterAll('generate' + self.getFileName(), self.updateGeneratedCode);\n                }\n            };\n            var triesUpdateRunButtons = 0;\n            var triesUpdateRunButtonsLimits = 20;\n            this.updateRunButtons = function() {\n                if ($('.blocklySelectBreakpointC').length == 0) {\n                    triesUpdateRunButtons++;\n                    if (triesUpdateRunButtons > triesUpdateRunButtonsLimits) {\n                        triesUpdateRunButtons = 0;\n                        VPLUtil.log('Giving up to tries of updateRunButtons');\n                        return;\n                    }\n                    VPLUtil.longDelay('updateRunButtons', self.updateRunButtons);\n                    return;\n                }\n                VPLUtil.log('updateRunButtons');\n                triesUpdateRunButtons = 0;\n                var dimmed = 'vpl_dimmed';\n                if (self.isSelectingBreakpoint()) {\n                    $('.blocklySelectBreakpointC').removeClass(dimmed);\n                } else {\n                    $('.blocklySelectBreakpointC').addClass(dimmed);\n                }\n                if (self.getBreakpoint() === null) {\n                    $('.blocklyRemoveBreakpointC').addClass(dimmed);\n                } else {\n                    $('.blocklyRemoveBreakpointC').removeClass(dimmed);\n                }\n                switch (self.executionState) {\n                    case self.RUNSTATE: {\n                        $('.blocklyStartC').addClass(dimmed);\n                        $('.blocklyStartAnimateC').addClass(dimmed);\n                        $('.blocklyStopC').removeClass(dimmed);\n                        $('.blocklyPauseC').removeClass(dimmed);\n                        $('.blocklyResumeC').addClass(dimmed);\n                        $('.blocklyStepC').addClass(dimmed);\n                        break;\n                    }\n                    case self.STEPSTATE: {\n                        $('.blocklyStartC').addClass(dimmed);\n                        $('.blocklyStartAnimateC').addClass(dimmed);\n                        $('.blocklyStopC').removeClass(dimmed);\n                        $('.blocklyPauseC').addClass(dimmed);\n                        $('.blocklyResumeC').removeClass(dimmed);\n                        $('.blocklyStepC').removeClass(dimmed);\n                        break;\n                    }\n                    case self.STOPSTATE: {\n                        $('.blocklyStartC').removeClass(dimmed);\n                        $('.blocklyStartAnimateC').removeClass(dimmed);\n                        $('.blocklyStopC').addClass(dimmed);\n                        $('.blocklyPauseC').addClass(dimmed);\n                        $('.blocklyResumeC').addClass(dimmed);\n                        $('.blocklyStepC').removeClass(dimmed);\n                        break;\n                    }\n                }\n            };\n            this.setToolbox = function() {\n                var ext = VPLUtil.fileExtension(this.getFileName());\n                var toolboxname = ext + 'Toolbox';\n                if (self[toolboxname] === false) {\n                    $.ajax({\n                        url: '../editor/blocklytoolboxes/' + toolboxname + '.xml',\n                        dataType: 'text',\n                        success: function(data) {\n                            self[toolboxname] = self.blocklyIn18(data);\n                            self.setToolbox();\n                        },\n                    });\n                    return;\n                }\n                var addUpdateButtons = function(func) {\n                    return function() {\n                        func();\n                        self.updateRunButtons();\n                    };\n                };\n                var callBacks = {\n                    'blocklyStartButton': this.start,\n                    'blocklyStartAnimateButton': this.startAnimate,\n                    'blocklyStopButton': this.stop,\n                    'blocklyPauseButton': this.pause,\n                    'blocklyResumeButton': this.resume,\n                    'blocklyStepButton': this.step,\n                    'blocklySelectBreakpointButton': this.setBreakpoint,\n                    'blocklyRemoveBreakpointButton': this.removeBreakpoint,\n                };\n                var wp = this.workspaceInstance;\n                wp.updateToolbox(this[toolboxname]);\n                for (var key in callBacks) {\n                    wp.registerButtonCallback(key, addUpdateButtons(callBacks[key]));\n                }\n                this.adjustSize();\n            };\n            this.open = function() {\n                this.showFileName();\n                if (self.blocklyNotLoaded) {\n                    VPLUtil.loadScript(\n                        [\n                            '../editor/blockly/blockly_compressed.js',\n                            '../editor/blockly/msg/js/en.js',\n                            '../editor/blockly/blocks_compressed.js',\n                            '../editor/blockly/python_compressed.js',\n                            '../editor/blockly/javascript_compressed.js',\n                            '../editor/blockly/php_compressed.js',\n                            '../editor/blockly/lua_compressed.js',\n                            '../editor/blockly/dart_compressed.js',\n                            '../editor/acorn/acorn.js',\n                            '../editor/acorn/interpreter.js',\n                        ],\n                        function() {\n                            VPLUtil.log('Blocklyloaded', true);\n                            adaptBlockly();\n                            self.blocklyNotLoaded = false;\n                            self.open();\n                        }\n                    );\n                    return false;\n                }\n                var code = this.getContent();\n                this.setOpen(true);\n                var fileName = this.getFileName();\n                var horizontalMenu = false;\n                if (/.*[0-9]$/.test(VPLUtil.fileExtension(fileName))) {\n                    horizontalMenu = true;\n                }\n                var tid = this.getTId();\n                // Workaround to remove jquery-ui theme background color.\n                $(tid).removeClass('ui-widget-content ui-tabs-panel');\n                $(tid).addClass('ui-corner-bottom');\n                this.bdiv = 'bkdiv' + this.getId();\n                $(tid).html('<div id=\"' + this.bdiv + '\" style=\"height: 480px; width: 600px;\"></div>');\n                var options = {\n                    toolbox: '<xml><category name=\"\" colour=\"330\"><block type=\"math_number\"></block></category></xml>',\n                    media: '../editor/blockly/media/',\n                    horizontalLayout: horizontalMenu,\n                    zoom: {\n                        controls: true,\n                        wheel: true,\n                        startScale: 1.0,\n                        maxScale: 3,\n                        minScale: 0.2,\n                        scaleSpeed: 1.05\n                    }\n                };\n                this.workspaceInstance = Blockly.inject(this.bdiv, options);\n                this.setToolbox();\n                this.firstContent = code > '';\n                self.workspaceInstance.addChangeListener(self.changeCode);\n                this.setContent(code);\n                VPLUtil.adjustBlockly(self.workspaceInstance, 10, 10);\n                self.workspaceInstance.scrollX = 0;\n                self.workspaceInstance.scrollY = 0;\n                Blockly.svgResize(self.workspaceInstance);\n                Blockly.resizeSvgContents(self.workspaceInstance);\n                self.setFileName(self.getFileName());\n                self.adjustSize();\n                // Must return false. Do not change it.\n                return false;\n            };\n            var getContentOld = this.getContent;\n            this.getContent = function() {\n                if (!this.isOpen()) {\n                    return getContentOld.call(this);\n                }\n                var xml = Blockly.Xml.workspaceToDom(this.workspaceInstance);\n                var xmlText = Blockly.Xml.domToPrettyText(xml);\n                return xmlText;\n            };\n            var setContentOld = this.setContent;\n            this.setContent = function(c) {\n                setContentOld.call(this, c);\n                if (c.length > 0 && this.isOpen()) {\n                    this.workspaceInstance.clear();\n                    var xml = Blockly.Xml.textToDom(c);\n                    Blockly.Xml.domToWorkspace(xml, this.workspaceInstance);\n                }\n            };\n            this.close = function() {\n                if (this.isOpen()) {\n                    setContentOld.call(this, this.getContent());\n                    this.workspaceInstance.dispose();\n                    this.workspaceInstance = false;\n                    this.setOpen(false);\n                }\n            };\n            this.blocklyNotLoaded = true;\n            this.blocklyToolbox = false;\n            this.blockly0Toolbox = false;\n            this.blockly1Toolbox = false;\n            this.blockly2Toolbox = false;\n            this.blockly3Toolbox = false;\n            this.blocklyStrs = [\n                'basic',\n                'intermediate',\n                'advanced',\n                'variables',\n                'operatorsvalues',\n                'control',\n                'inputoutput',\n                'functions',\n                'lists',\n                'math',\n                'text',\n                'run',\n                'start',\n                'startanimate',\n                'stop',\n                'pause',\n                'resume',\n                'step',\n                'breakpoint',\n                'selectbreakpoint',\n                'removebreakpoint'\n            ];\n            this.blocklyIn18 = function(data) {\n                var l = this.blocklyStrs.length;\n                for (var i = 0; i < l; i++) {\n                    var str = this.blocklyStrs[i];\n                    var reg = new RegExp('\\\\[\\\\[' + str + '\\\\]\\\\]', 'g');\n                    var rep = VPLUtil.str(str);\n                    data = data.replace(reg, rep);\n                }\n                return data;\n            };\n        };\n    }\n);\n"],"mappings":"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"}