{"version":3,"file":"vplidefile.min.js","names":["define","$","jqui","VPLUtil","codeExtension","blocklyExtension","binaryExtension","id","name","value","fileManager","vplIdeInstance","tid","tabnameid","fileName","modified","opened","self","getContent","setContent","c","getFileManager","getFileName","getId","getTabNameId","getTId","isModified","resetModified","showFileName","setModified","getTabPos","isOpen","setOpen","openState","getVPLIDE","change","generateFileList","longDelay","setFileName","validPath","langSelection","fn","length","substring","html","iconModified","minNumberOfFiles","iconRequired","iconClose","attr","afterAll","adjustTabsTitles","delay","adjustSize","destroy","remove","editTag","tabs","parent","editorHeight","height","editorWidth","width","newHeight","position","top","newWidth","gotoLine","doNothing","setReadOnly","focus","blur","undo","redo","selectAll","open","hasUndo","returnFalse","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","find","replace","next","getAnnotations","setAnnotations","setFontSize","setTheme","clearAnnotations","isBinary","extendToCodeEditor","extendToBlockly","extendToBinary"],"sources":["../src/vplidefile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File management\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplidecodefile',\n        'mod_vpl/vplideblocklyfile',\n        'mod_vpl/vplidebinaryfile',\n    ],\n    function($, jqui, VPLUtil, codeExtension, blocklyExtension, binaryExtension) {\n        return function(id, name, value, fileManager, vplIdeInstance) {\n            var tid = \"#vpl_file\" + id;\n            var tabnameid = \"#vpl_tab_name\" + id;\n            var fileName = name;\n            var modified = true;\n            var opened = false;\n            var self = this;\n            this.getContent = function() {\n                return value;\n            };\n            this.setContent = function(c) {\n                value = c;\n            };\n            this.getFileManager = function() {\n                return fileManager;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.getId = function() {\n                return id;\n            };\n            this.getTabNameId = function() {\n                return tabnameid;\n            };\n            this.getTId = function() {\n                return tid;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.isModified = function() {\n                return modified;\n            };\n            this.resetModified = function() {\n                modified = false;\n                this.showFileName();\n            };\n            this.setModified = function() {\n                modified = true;\n                this.showFileName();\n            };\n            this.getTabPos = function() {\n                return fileManager.getTabPos(this);\n            };\n            this.isOpen = function() {\n                return opened;\n            };\n            this.setOpen = function(openState) {\n                opened = openState;\n            };\n            this.getVPLIDE = function() {\n                return vplIdeInstance;\n            };\n            this.change = function() {\n                if (!modified) {\n                    this.setModified();\n                    fileManager.generateFileList();\n                    this.showFileName();\n                    VPLUtil.longDelay('setModified', fileManager.setModified);\n                }\n            };\n            this.setFileName = function(name) {\n                if (!VPLUtil.validPath(name)) {\n                    return false;\n                }\n                if (name != fileName) {\n                    fileName = name;\n                    self.change();\n                }\n                if (!this.isOpen()) {\n                    return true;\n                }\n                this.showFileName();\n                this.langSelection();\n                return true;\n            };\n            this.showFileName = function() {\n                var name = this.getFileName();\n                var fn = VPLUtil.getFileName(name);\n                if (fn.length > 20) {\n                    fn = fn.substring(0, 16) + '...';\n                }\n                var html = (modified ? VPLUtil.iconModified() : '') + fn;\n                if (this.getTabPos() < fileManager.minNumberOfFiles) {\n                    html = html + VPLUtil.iconRequired();\n                } else {\n                    html = html + VPLUtil.iconClose();\n                }\n                $(tabnameid + ' a').html(html);\n                if (fn != name) {\n                    $(tabnameid + ' a').attr('title', name);\n                }\n                VPLUtil.afterAll('adjustTabsTitles' + self.id, function() {\n                    fileManager.adjustTabsTitles(true);\n                    VPLUtil.delay('adjustTabsTitles' + self.id, function() {\n                        self.adjustSize();\n                    });\n                });\n            };\n\n            this.destroy = function() {\n                $(tabnameid).remove();\n                $(tid).remove();\n            };\n\n            this.adjustSize = function() {\n                if (!this.isOpen()) {\n                    return false;\n                }\n                var editTag = $(tid);\n                var tabs = editTag.parent();\n                if (editTag.length === 0) {\n                    return false;\n                }\n                var editorHeight = editTag.height();\n                var editorWidth = editTag.width();\n                var newHeight = tabs.height();\n                newHeight -= editTag.position().top;\n                var newWidth = $('#vpl_tabs_scroll').width();\n                if (newHeight != editorHeight || newWidth != editorWidth) {\n                    $(editTag).height(newHeight);\n                    $(editTag).width(newWidth);\n                    return true;\n                }\n                return false;\n            };\n            this.gotoLine = VPLUtil.doNothing;\n            this.setReadOnly = VPLUtil.doNothing;\n            this.focus = VPLUtil.doNothing;\n            this.blur = VPLUtil.doNothing;\n            this.undo = VPLUtil.doNothing;\n            this.redo = VPLUtil.doNothing;\n            this.selectAll = VPLUtil.doNothing;\n            this.open = VPLUtil.doNothing;\n            this.hasUndo = VPLUtil.returnFalse;\n            this.hasRedo = VPLUtil.returnFalse;\n            this.hasSelectAll = VPLUtil.returnFalse;\n            this.hasFind = VPLUtil.returnFalse;\n            this.hasFindReplace = VPLUtil.returnFalse;\n            this.hasNext = VPLUtil.returnFalse;\n            this.find = VPLUtil.doNothing;\n            this.replace = VPLUtil.doNothing;\n            this.next = VPLUtil.doNothing;\n            this.getAnnotations = function() {\n                return [];\n            };\n            this.setAnnotations = VPLUtil.doNothing;\n            this.setFontSize = VPLUtil.doNothing;\n            this.setTheme = VPLUtil.doNothing;\n            this.clearAnnotations = VPLUtil.doNothing;\n            this.langSelection = VPLUtil.doNothing;\n            this.isBinary = VPLUtil.returnFalse;\n            // Adds support for current extensions\n            this.extendToCodeEditor = codeExtension;\n            this.extendToBlockly = blocklyExtension;\n            this.extendToBinary = binaryExtension;\n        };\n    }\n);\n"],"mappings":"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"}