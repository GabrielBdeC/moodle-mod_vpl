{"version":3,"file":"vplidefile.min.js","names":["define","$","jqui","VPLUtil","codeExtension","blocklyExtension","binaryExtension","id","name","value","fileManager","vplIdeInstance","tid","tabnameid","fileName","modified","opened","self","getContent","setContent","c","getFileManager","getFileName","getId","getTabNameId","getTId","isModified","resetModified","showFileName","setModified","getTabPos","isOpen","setOpen","openState","getVPLIDE","change","generateFileList","longDelay","setFileName","validPath","langSelection","fn","length","substring","html","iconModified","minNumberOfFiles","iconRequired","iconClose","attr","afterAll","adjustTabsTitles","delay","adjustSize","destroy","remove","editTag","tabs","parent","editorHeight","height","editorWidth","width","newHeight","position","top","newWidth","gotoLine","doNothing","setReadOnly","focus","blur","undo","redo","selectAll","open","hasUndo","returnFalse","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","find","replace","next","getAnnotations","setAnnotations","setFontSize","setTheme","clearAnnotations","isBinary","extendToCodeEditor","extendToBlockly","extendToBinary"],"sources":["../src/vplidefile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File management\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplidecodefile',\n        'mod_vpl/vplideblocklyfile',\n        'mod_vpl/vplidebinaryfile',\n    ],\n    function($, jqui, VPLUtil, codeExtension, blocklyExtension, binaryExtension) {\n        return function(id, name, value, fileManager, vplIdeInstance) {\n            var tid = \"#vpl_file\" + id;\n            var tabnameid = \"#vpl_tab_name\" + id;\n            var fileName = name;\n            var modified = true;\n            var opened = false;\n            var self = this;\n            this.getContent = function() {\n                return value;\n            };\n            this.setContent = function(c) {\n                value = c;\n            };\n            this.getFileManager = function() {\n                return fileManager;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.getId = function() {\n                return id;\n            };\n            this.getTabNameId = function() {\n                return tabnameid;\n            };\n            this.getTId = function() {\n                return tid;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.isModified = function() {\n                return modified;\n            };\n            this.resetModified = function() {\n                modified = false;\n                this.showFileName();\n            };\n            this.setModified = function() {\n                modified = true;\n                this.showFileName();\n            };\n            this.getTabPos = function() {\n                return fileManager.getTabPos(this);\n            };\n            this.isOpen = function() {\n                return opened;\n            };\n            this.setOpen = function(openState) {\n                opened = openState;\n            };\n            this.getVPLIDE = function() {\n                return vplIdeInstance;\n            };\n            this.change = function() {\n                if (!modified) {\n                    this.setModified();\n                    fileManager.generateFileList();\n                    this.showFileName();\n                    VPLUtil.longDelay('setModified', fileManager.setModified);\n                }\n            };\n            this.setFileName = function(name) {\n                if (!VPLUtil.validPath(name)) {\n                    return false;\n                }\n                if (name != fileName) {\n                    fileName = name;\n                    self.change();\n                }\n                if (!this.isOpen()) {\n                    return true;\n                }\n                this.showFileName();\n                this.langSelection();\n                return true;\n            };\n            this.showFileName = function() {\n                var name = this.getFileName();\n                var fn = VPLUtil.getFileName(name);\n                if (fn.length > 20) {\n                    fn = fn.substring(0, 16) + '...';\n                }\n                var html = (modified ? VPLUtil.iconModified() : '') + fn;\n                if (this.getTabPos() < fileManager.minNumberOfFiles) {\n                    html = html + VPLUtil.iconRequired();\n                } else {\n                    html = html + VPLUtil.iconClose();\n                }\n                $(tabnameid + ' a').html(html);\n                if (fn != name) {\n                    $(tabnameid + ' a').attr('title', name);\n                }\n                VPLUtil.afterAll('adjustTabsTitles' + self.id, function() {\n                    fileManager.adjustTabsTitles(true);\n                    VPLUtil.delay('adjustTabsTitles' + self.id, function() {\n                        self.adjustSize();\n                    });\n                });\n            };\n\n            this.destroy = function() {\n                $(tabnameid).remove();\n                $(tid).remove();\n            };\n\n            this.adjustSize = function() {\n                if (!this.isOpen()) {\n                    return false;\n                }\n                var editTag = $(tid);\n                var tabs = editTag.parent();\n                if (editTag.length === 0) {\n                    return false;\n                }\n                var editorHeight = editTag.height();\n                var editorWidth = editTag.width();\n                var newHeight = tabs.height();\n                newHeight -= editTag.position().top;\n                var newWidth = $('#vpl_tabs_scroll').width();\n                if (newHeight != editorHeight || newWidth != editorWidth) {\n                    $(editTag).height(newHeight);\n                    $(editTag).width(newWidth);\n                    return true;\n                }\n                return false;\n            };\n            this.gotoLine = VPLUtil.doNothing;\n            this.setReadOnly = VPLUtil.doNothing;\n            this.focus = VPLUtil.doNothing;\n            this.blur = VPLUtil.doNothing;\n            this.undo = VPLUtil.doNothing;\n            this.redo = VPLUtil.doNothing;\n            this.selectAll = VPLUtil.doNothing;\n            this.open = VPLUtil.doNothing;\n            this.hasUndo = VPLUtil.returnFalse;\n            this.hasRedo = VPLUtil.returnFalse;\n            this.hasSelectAll = VPLUtil.returnFalse;\n            this.hasFind = VPLUtil.returnFalse;\n            this.hasFindReplace = VPLUtil.returnFalse;\n            this.hasNext = VPLUtil.returnFalse;\n            this.find = VPLUtil.doNothing;\n            this.replace = VPLUtil.doNothing;\n            this.next = VPLUtil.doNothing;\n            this.getAnnotations = function() {\n                return [];\n            };\n            this.setAnnotations = VPLUtil.doNothing;\n            this.setFontSize = VPLUtil.doNothing;\n            this.setTheme = VPLUtil.doNothing;\n            this.clearAnnotations = VPLUtil.doNothing;\n            this.langSelection = VPLUtil.doNothing;\n            this.isBinary = VPLUtil.returnFalse;\n            // Adds support for current extensions\n            this.extendToCodeEditor = codeExtension;\n            this.extendToBlockly = blocklyExtension;\n            this.extendToBinary = binaryExtension;\n        };\n    }\n);\n"],"mappings":"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"}