/**
 * Evaluation monitoring
 *
 * @copyright 2013 onward Juan Carlos Rodríguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define(['mod_vpl/vplutil'], function (VPLUtil) {
  return {
    init: function (options) {
      options.next = function () {
        window.location = options.nexturl;
      };
      function showErrorMessage(message) {
        VPLUtil.showErrorMessage(message, {
          next: options.next
        });
      }
      var action;
      var executionActions = {
        'ajaxurl': options.ajaxurl,
        'run': showErrorMessage,
        'getLastAction': function () {
          action();
        }
      };
      action = function () {
        VPLUtil.requestAction('evaluate', 'evaluating', {}, options.ajaxurl).done(function (response) {
          VPLUtil.webSocketMonitor(response, 'evaluate', 'evaluating', executionActions).done(options.next).fail(showErrorMessage);
        }).fail(showErrorMessage);
      };
      action();
    }
  };
});
//# sourceMappingURL=evaluationmonitor.min.js.map