{"version":3,"file":"vplidebutton.min.js","names":["define","$","jqui","VPLUtil","VPLIDEButtons","menuElement","isOptionAllowed","self","buttons","notAdded","buttonName","setText","icon","title","str","hasOwnProperty","key","attr","replaceWith","genIcon","setExtracontent","html","cl","btag","find","length","append","add","button","name","active","editorName","originalAction","doNothing","Error","setAction","command","bindKey","exec","action","platform","navigator","startsWith","getHTML","enable","bw","data","addClass","removeClass","getAction","launchAction","setGetkeys","editor","commands","Key","getShortcuts","on","event","actionid","replace","setTimeout","stopImmediatePropagation","check","strkey","shiftKey","altKey","ctrlKey","metaKey","which","char","String","fromCharCode","toLowerCase","preventDefault","multiple","v","m","start","lastLap","interval","hour","day","cssclasses","show","element","precision","checkt","timeLeft","updatePrecision","updateTimeLeft","now","getCurrentTime","tl","cssclass","thtml","getTimeLeft","toggleTimeLeft","setTimeLeft","options","clearInterval","sync","setInterval","hide","window"],"sources":["../src/vplidebutton.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * IDE Buttons\n *\n * @copyright 2016 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n    ],\n    function($, jqui, VPLUtil) {\n        if (typeof VPLIDEButtons !== 'undefined') {\n            return VPLIDEButtons;\n        }\n        var VPLIDEButtons = function(menuElement, isOptionAllowed) {\n            var self = this;\n            var buttons = {};\n\n            this.notAdded = function(buttonName) {\n                return !buttons[buttonName];\n            };\n            this.setText = function(buttonName, icon, title) {\n                if (self.notAdded(buttonName)) {\n                    return;\n                }\n                if (!icon) {\n                    icon = buttons[buttonName].icon;\n                }\n                if (!title) {\n                    title = buttons[buttonName].title;\n                }\n                if (!title) {\n                    title = VPLUtil.str(icon);\n                }\n                buttons[buttonName].icon = icon;\n                buttons[buttonName].title = title;\n                if (buttons[buttonName].hasOwnProperty('key')) {\n                    title += ' (' + buttons[buttonName].key + ')';\n                }\n                $('#vpl_ide_' + buttonName).attr('title', title);\n                $('#vpl_ide_' + buttonName + ' i').replaceWith(VPLUtil.genIcon(icon));\n            };\n            this.setExtracontent = function(buttonName, html) {\n                if (self.notAdded(buttonName)) {\n                    return;\n                }\n                var cl = 'bt_extrahtml';\n                var btag = $('#vpl_ide_' + buttonName + ' i');\n                if (btag.find('.' + cl).length == 0) {\n                    btag.append(' <span class=\"' + cl + '\"><span>');\n                }\n                btag.find('.' + cl).html(html);\n            };\n            this.add = function(button) {\n                if (typeof button === 'string') {\n                    var name = button;\n                    button = {\n                        'name': name\n                    };\n                }\n                if (!isOptionAllowed(button.name)) {\n                    return;\n                }\n                if (!button.hasOwnProperty('icon')) {\n                    button.icon = button.name;\n                }\n                if (!button.hasOwnProperty('title')) {\n                    button.title = VPLUtil.str(button.name);\n                }\n                if (!button.hasOwnProperty('active')) {\n                    button.active = true;\n                }\n                if (!button.hasOwnProperty('editorName')) {\n                    button.editorName = button.name;\n                }\n                if (!button.hasOwnProperty('originalAction')) {\n                    button.originalAction = VPLUtil.doNothing;\n                }\n                if (self.notAdded(button.name)) {\n                    buttons[button.name] = button;\n                } else {\n                    throw new Error(\"Button already set \" + button.name);\n                }\n                self.setAction(button.name, button.originalAction);\n                if (button.hasOwnProperty('bindKey')) {\n                    button.command = {\n                        name: button.editorName,\n                        bindKey: button.bindKey,\n                        exec: button.action\n                    };\n                    var platform = \"win\";\n                    if (navigator.platform.startsWith(\"Mac\")) {\n                        platform = \"mac\";\n                    }\n                    button.key = button.bindKey[platform];\n                }\n            };\n            this.getHTML = function(buttonName) {\n                if (self.notAdded(buttonName)) {\n                    return '';\n                } else {\n                    var title = buttons[buttonName].title;\n                    if (buttons[buttonName].hasOwnProperty('key')) {\n                        title += ' (' + buttons[buttonName].key + ')';\n                    }\n\n                    var html = \"<a id='vpl_ide_\" + buttonName + \"' href='#' title='\" + title + \"'>\";\n                    html += VPLUtil.genIcon(buttons[buttonName].icon) + \"</a>\";\n                    return html;\n                }\n            };\n\n            this.enable = function(buttonName, active) {\n                if (self.notAdded(buttonName)) {\n                    return;\n                }\n                var bw = $('#vpl_ide_' + buttonName);\n                buttons[buttonName].active = active;\n                bw.data(\"vpl-active\", active);\n                if (!active) {\n                    bw.addClass('ui-button-disabled ui-state-disabled');\n                } else {\n                    bw.removeClass('ui-button-disabled ui-state-disabled');\n                }\n            };\n            this.setAction = function(buttonName, action) {\n                if (self.notAdded(buttonName)) {\n                    return;\n                }\n                buttons[buttonName].originalAction = action;\n                buttons[buttonName].action = function() {\n                    if (buttons[buttonName].active) {\n                        action();\n                    }\n                };\n            };\n            this.getAction = function(buttonName) {\n                if (self.notAdded(buttonName)) {\n                    return VPLUtil.doNothing;\n                }\n                return buttons[buttonName].action;\n            };\n            this.launchAction = function(buttonName) {\n                if (self.notAdded(buttonName)) {\n                    return;\n                }\n                buttons[buttonName].originalAction();\n            };\n            this.setGetkeys = function(editor) {\n                if (!editor) {\n                    return;\n                }\n                var commands = editor.commands.commands;\n                var platform = editor.commands.platform;\n                for (var buttonName in buttons) {\n                    if (buttons.hasOwnProperty(buttonName)) {\n                        var editorName = buttons[buttonName].editorName;\n                        if (commands[editorName] && commands[editorName].bindKey && !buttons[buttonName].Key) {\n                            buttons[buttonName].key = commands[editorName].bindKey[platform];\n                            self.setText(buttonName);\n                        } else {\n                            if (buttons[buttonName].bindKey &&\n                                !buttons[buttonName].hasOwnProperty('key')) {\n                                buttons[buttonName].key = buttons[buttonName].bindKey[platform];\n                                self.setText(buttonName);\n                            }\n                        }\n                    }\n                }\n            };\n            this.getShortcuts = function(editor) {\n                var html = '<ul>';\n                for (var buttonName in buttons) {\n                    if (buttons[buttonName].hasOwnProperty('key')) {\n                        html += '<li>';\n                        html += buttons[buttonName].title + ' (' + buttons[buttonName].key + ')';\n                        html += '</li>';\n                    }\n                }\n                html += '</ul>';\n                if (editor) {\n                    html += '<h5>' + VPLUtil.str('edit') + '</h5>';\n                    var commands = editor.commands.commands;\n                    var platform = editor.commands.platform;\n                    html += '<ul>';\n                    for (var editorName in commands) {\n                        if (commands[editorName].hasOwnProperty('bindKey') && commands[editorName].bindKey[platform] > '') {\n                            html += '<li>';\n                            html += editorName + ' (' + commands[editorName].bindKey[platform] + ')';\n                            html += '</li>';\n                        }\n                    }\n                    html += '</ul>';\n                }\n                if (html == '<ul></ul>') {\n                    return '';\n                }\n                return html;\n            };\n            $(menuElement).on(\"click\", \"a\", function(event) {\n                if ($(this).data(\"vpl-active\")) {\n                    var actionid = $(this).attr('id');\n                    if (typeof actionid === 'string' && actionid.startsWith('vpl_ide_')) {\n                        actionid = actionid.replace('vpl_ide_', '');\n                    } else {\n                        return true;\n                    }\n                    if (self.notAdded(actionid)) {\n                        return true;\n                    }\n                    if (buttons[actionid] && !buttons[actionid].active) {\n                        return true;\n                    }\n                    var action = self.getAction(actionid);\n                    if (actionid != 'import') {\n                        setTimeout(action, 10);\n                    } else {\n                        action();\n                    }\n                }\n                event.stopImmediatePropagation();\n                return false;\n            });\n\n            $('body').on('keydown', function(event) {\n                var check = false;\n                var strkey = '';\n                if (event.shiftKey) {\n                    strkey += 'shift-';\n                }\n                if (event.altKey) {\n                    strkey += 'alt-';\n                    check = true;\n                }\n                if (event.ctrlKey) {\n                    strkey += 'ctrl-';\n                    check = true;\n                }\n                if (event.metaKey) {\n                    strkey += 'meta-';\n                    check = true;\n                }\n                if (event.which >= 112 && event.which <= 123) {\n                    strkey += 'f' + (event.which - 111);\n                    check = true;\n                } else {\n                    var char = String.fromCharCode(event.which).toLowerCase();\n                    if (char < 'a' || char > 'z') {\n                        check = false;\n                    } else {\n                        strkey += char;\n                    }\n                }\n                if (check) {\n                    for (var buttonName in buttons) {\n                        if (buttons[buttonName].hasOwnProperty('key')) {\n                            if (strkey == buttons[buttonName].key.toLowerCase()) {\n                                event.preventDefault();\n                                event.stopImmediatePropagation();\n                                buttons[buttonName].action();\n                                return false;\n                            }\n                        }\n                    }\n                }\n                return true;\n            });\n            this.multiple = function(v, m) {\n                return v - (v % m);\n            };\n\n            (function() {\n                var start = 0;\n                var lastLap = 0;\n                var interval = false;\n                var hour = 60 * 60;\n                var day = hour * 24;\n                var cssclasses = 'vpl_buttonleft_orange vpl_buttonleft_red vpl_buttonleft_black';\n                var show = false;\n                var element = null;\n                var precision = 5;\n                var checkt = 1000;\n                var timeLeft = 0;\n                var updatePrecision = function(timeLeft) {\n                    precision = 5;\n                    checkt = 1000;\n                    if (timeLeft > hour) {\n                        precision = 60;\n                        checkt = 5000;\n                    } else if (timeLeft > day) {\n                        precision = 5 * 60;\n                        checkt = 5 * 5000;\n                    }\n                };\n                var updateTimeLeft = function() {\n                    var now = self.multiple(VPLUtil.getCurrentTime(), precision);\n                    if (now === lastLap || element === null) {\n                        return;\n                    }\n                    lastLap = now;\n                    var tl = timeLeft - (lastLap - start);\n                    var cssclass = '';\n                    if (tl <= 0) {\n                        cssclass = 'vpl_buttonleft_black';\n                    } else if (tl <= 5 * 60) {\n                        show = true;\n                        cssclass = 'vpl_buttonleft_red';\n                    } else if (tl <= 15 * 60) {\n                        cssclass = 'vpl_buttonleft_orange';\n                    } else {\n                        updatePrecision(tl);\n                    }\n                    var thtml = '<span class=\"' + cssclass + '\">' + VPLUtil.genIcon('timeleft');\n                    if (show) {\n                        thtml += ' ' + VPLUtil.getTimeLeft(tl);\n                    }\n                    thtml += '</span>';\n                    element.html(thtml);\n                    element.removeClass(cssclasses);\n                    element.addClass(cssclass);\n                };\n                self.toggleTimeLeft = function() {\n                    show = !show;\n                    lastLap = 0;\n                    updateTimeLeft();\n                };\n                self.setTimeLeft = function(options) {\n                    element = $('#vpl_ide_timeleft');\n                    if (interval !== false) {\n                        clearInterval(interval);\n                        interval = false;\n                    }\n                    if (options.hasOwnProperty('timeLeft')) {\n                        timeLeft = options.timeLeft;\n                        updatePrecision(timeLeft);\n                        var sync = timeLeft % precision;\n                        timeLeft = self.multiple(timeLeft, precision);\n                        start = self.multiple(VPLUtil.getCurrentTime(), precision);\n                        lastLap = start - precision;\n                        setTimeout(function() {\n                            interval = setInterval(updateTimeLeft, checkt);\n                        }, sync * 1000);\n                        $('#vpl_ide_timeleft').show();\n                        updateTimeLeft();\n\n                    } else {\n                        $('#vpl_ide_timeleft').hide();\n                    }\n                };\n            })();\n        };\n        window.VPLIDEButtons = VPLIDEButtons;\n        return VPLIDEButtons;\n    }\n);\n"],"mappings":"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"}