{"version":3,"file":"vplidebinaryfile.min.js","names":["define","$","VPLUtil","isBinary","setOldContent","setContent","c","call","setModified","updateDataURL","fileName","getFileName","value","getContent","tid","getTId","isImage","prevalue","getMIME","find","attr","adjustSize","isOpen","editTag","length","tabs","parent","newHeight","height","position","top","open","showFileName","setOpen","addClass","append","text","str","close"],"sources":["../src/vplidebinaryfile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Binary files extension methods. Add to VPLFile object.\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\ndefine(\n    [\n        'jquery',\n        'mod_vpl/vplutil',\n    ],\n    function($, VPLUtil) {\n        return function() {\n            this.isBinary = function() {\n                return true;\n            };\n            var setOldContent = this.setContent;\n            this.setContent = function(c) {\n                setOldContent.call(this, c);\n                this.setModified();\n                this.updateDataURL();\n            };\n            this.updateDataURL = function() {\n                var fileName = this.getFileName();\n                var value = this.getContent();\n                var tid = this.getTId();\n                if (VPLUtil.isImage(fileName)) {\n                    var prevalue = 'data:' + VPLUtil.getMIME(fileName) + ';base64,';\n                    $(tid).find('img').attr('src', prevalue + value);\n                } else {\n                    $(tid).find('img').attr('src', '');\n                }\n            };\n            this.adjustSize = function() {\n                if (!this.isOpen()) {\n                    return false;\n                }\n                var editTag = $(this.getTId());\n                if (editTag.length === 0) {\n                    return false;\n                }\n                var tabs = editTag.parent();\n                var newHeight = tabs.height();\n                newHeight -= editTag.position().top;\n                if (newHeight != editTag.height()) {\n                    editTag.height(newHeight);\n                    return true;\n                }\n                return false;\n            };\n            this.open = function() {\n                this.showFileName();\n                var fileName = this.getFileName();\n                var tid = this.getTId();\n                this.setOpen(true);\n                if (VPLUtil.isImage(fileName)) {\n                    $(tid).addClass('vpl_ide_img').append('<img />');\n                    this.updateDataURL();\n                } else {\n                    $(tid).addClass('vpl_ide_binary').text(VPLUtil.str('binaryfile'));\n                }\n            };\n            this.close = function() {\n                this.setOpen(false);\n            };\n        };\n    }\n);\n"],"mappings":"AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAA,MAAM,CACF,CACI,QAAQ,EACR,iBAAiB,CACpB,EACD,UAASC,CAAC,EAAEC,OAAO,EAAE;EACjB,OAAO,YAAW;IACd,IAAI,CAACC,QAAQ,GAAG,YAAW;MACvB,OAAO,IAAI;IACf,CAAC;IACD,IAAIC,aAAa,GAAG,IAAI,CAACC,UAAU;IACnC,IAAI,CAACA,UAAU,GAAG,UAASC,CAAC,EAAE;MAC1BF,aAAa,CAACG,IAAI,CAAC,IAAI,EAAED,CAAC,CAAC;MAC3B,IAAI,CAACE,WAAW,EAAE;MAClB,IAAI,CAACC,aAAa,EAAE;IACxB,CAAC;IACD,IAAI,CAACA,aAAa,GAAG,YAAW;MAC5B,IAAIC,QAAQ,GAAG,IAAI,CAACC,WAAW,EAAE;MACjC,IAAIC,KAAK,GAAG,IAAI,CAACC,UAAU,EAAE;MAC7B,IAAIC,GAAG,GAAG,IAAI,CAACC,MAAM,EAAE;MACvB,IAAIb,OAAO,CAACc,OAAO,CAACN,QAAQ,CAAC,EAAE;QAC3B,IAAIO,QAAQ,GAAG,OAAO,GAAGf,OAAO,CAACgB,OAAO,CAACR,QAAQ,CAAC,GAAG,UAAU;QAC/DT,CAAC,CAACa,GAAG,CAAC,CAACK,IAAI,CAAC,KAAK,CAAC,CAACC,IAAI,CAAC,KAAK,EAAEH,QAAQ,GAAGL,KAAK,CAAC;MACpD,CAAC,MAAM;QACHX,CAAC,CAACa,GAAG,CAAC,CAACK,IAAI,CAAC,KAAK,CAAC,CAACC,IAAI,CAAC,KAAK,EAAE,EAAE,CAAC;MACtC;IACJ,CAAC;IACD,IAAI,CAACC,UAAU,GAAG,YAAW;MACzB,IAAI,CAAC,IAAI,CAACC,MAAM,EAAE,EAAE;QAChB,OAAO,KAAK;MAChB;MACA,IAAIC,OAAO,GAAGtB,CAAC,CAAC,IAAI,CAACc,MAAM,EAAE,CAAC;MAC9B,IAAIQ,OAAO,CAACC,MAAM,KAAK,CAAC,EAAE;QACtB,OAAO,KAAK;MAChB;MACA,IAAIC,IAAI,GAAGF,OAAO,CAACG,MAAM,EAAE;MAC3B,IAAIC,SAAS,GAAGF,IAAI,CAACG,MAAM,EAAE;MAC7BD,SAAS,IAAIJ,OAAO,CAACM,QAAQ,EAAE,CAACC,GAAG;MACnC,IAAIH,SAAS,IAAIJ,OAAO,CAACK,MAAM,EAAE,EAAE;QAC/BL,OAAO,CAACK,MAAM,CAACD,SAAS,CAAC;QACzB,OAAO,IAAI;MACf;MACA,OAAO,KAAK;IAChB,CAAC;IACD,IAAI,CAACI,IAAI,GAAG,YAAW;MACnB,IAAI,CAACC,YAAY,EAAE;MACnB,IAAItB,QAAQ,GAAG,IAAI,CAACC,WAAW,EAAE;MACjC,IAAIG,GAAG,GAAG,IAAI,CAACC,MAAM,EAAE;MACvB,IAAI,CAACkB,OAAO,CAAC,IAAI,CAAC;MAClB,IAAI/B,OAAO,CAACc,OAAO,CAACN,QAAQ,CAAC,EAAE;QAC3BT,CAAC,CAACa,GAAG,CAAC,CAACoB,QAAQ,CAAC,aAAa,CAAC,CAACC,MAAM,CAAC,SAAS,CAAC;QAChD,IAAI,CAAC1B,aAAa,EAAE;MACxB,CAAC,MAAM;QACHR,CAAC,CAACa,GAAG,CAAC,CAACoB,QAAQ,CAAC,gBAAgB,CAAC,CAACE,IAAI,CAAClC,OAAO,CAACmC,GAAG,CAAC,YAAY,CAAC,CAAC;MACrE;IACJ,CAAC;IACD,IAAI,CAACC,KAAK,GAAG,YAAW;MACpB,IAAI,CAACL,OAAO,CAAC,KAAK,CAAC;IACvB,CAAC;EACL,CAAC;AACL,CAAC,CACJ"}